import React, { useEffect } from 'react';
import { MapContainer, TileLayer, Marker, Popup, Circle, LayersControl, GeoJSON, useMap } from 'react-leaflet';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import 'leaflet.heat';

import icon from 'leaflet/dist/images/marker-icon.png';
import iconShadow from 'leaflet/dist/images/marker-shadow.png';

let DefaultIcon = L.divIcon({
  className: 'custom-div-icon',
  html: "<div style='background-color:#4285f4;width:12px;height:12px;border-radius:50%;border:3px solid white;'></div>",
});

L.Marker.prototype.options.icon = DefaultIcon;

const HeatmapLayer = ({ data }) => {
  const map = useMap();

  useEffect(() => {
    if (!data || data.length === 0) return;

    const heat = L.heatLayer(data, {
      radius: 25,
      blur: 15,
      maxZoom: 10,
      gradient: {0: 'red', 0.5: 'yellow', 1: 'green'}
    }).addTo(map);

    return () => {
      map.removeLayer(heat);
    };
  }, [map, data]);

  return null;
};

const App = () => {
  const position = [-20.9176, 142.7028];
  
  const sampleGeoJSON = {
    "type": "Feature",
    "properties": {
      "name": "Sample Area",
      "popupContent": "This is a sample GeoJSON polygon"
    },
    "geometry": {
      "type": "Polygon",
      "coordinates": [[
        [153.0, -27.5],
        [153.1, -27.5],
        [153.1, -27.4],
        [153.0, -27.4],
        [153.0, -27.5]
      ]]
    }
  };

  const markers = [
    { position: [-27.4705, 153.0260], popup: "Here will be the most desirable location of the data center" },
    { position: [-19.2590, 146.8169], popup: "Secondary location " },
    { position: [-16.9186, 145.7781], popup: "Third Location" },
  ];

  const heatmapData = [
    [-27.4705, 153.0260, 0.9], [-19.2590, 146.8169, 0.8], [-16.9186, 145.7781, 0.7], [-28.0167, 153.4000, 0.8], [-21.1459, 149.1664, 0.6],
    [-26.6524, 153.0819, 0.5], [-23.3478, 150.5156, 0.7], [-20.7256, 139.4927, 0.4], [-25.9461, 152.7792, 0.6], [-24.8614, 152.3426, 0.5],
    [-27.3818, 153.1188, 0.8], [-22.5431, 151.7831, 0.7], [-18.2871, 142.7028, 0.4], [-26.4390, 153.0278, 0.9], [-24.7136, 153.0986, 0.6],
    [-25.2818, 152.8750, 0.5], [-19.7490, 146.2780, 0.7], [-17.3599, 145.3781, 0.6], [-21.8847, 152.4394, 0.8], [-26.8468, 153.2695, 0.4],
    [-23.8588, 151.2073, 0.7], [-20.2179, 148.6982, 0.5], [-16.2886, 145.4424, 0.6], [-25.6123, 152.9562, 0.8], [-22.2711, 149.7692, 0.7],
    [-18.9962, 146.7731, 0.5], [-27.6362, 153.2302, 0.9], [-24.3332, 151.7838, 0.6], [-19.3259, 146.7425, 0.7], [-26.1288, 152.4336, 0.4],
    [-23.1028, 150.1292, 0.8], [-17.9648, 140.7731, 0.3], [-25.3444, 152.0397, 0.6], [-21.4272, 149.2789, 0.5], [-18.6951, 142.2718, 0.4],
    [-27.2046, 152.9631, 0.7], [-24.0579, 151.9497, 0.8], [-20.6617, 139.4927, 0.6], [-26.3408, 152.7348, 0.5], [-22.9068, 150.8571, 0.7],
    [-19.1557, 146.8169, 0.8], [-25.7308, 152.8147, 0.4], [-23.6890, 150.9043, 0.6], [-17.7287, 142.1731, 0.5], [-26.8468, 153.0819, 0.9],
    [-21.7203, 149.2789, 0.7], [-18.5115, 145.7781, 0.6], [-24.8876, 152.3426, 0.8], [-22.4918, 151.2631, 0.5], [-19.9907, 146.7425, 0.7],
    [-27.1234, 152.8901, 0.8], [-26.5432, 153.1234, 0.6], [-25.8901, 152.4567, 0.7], [-24.9876, 151.7890, 0.5], [-23.4567, 150.2341, 0.9],
    [-22.7890, 149.5674, 0.4], [-21.2345, 148.8907, 0.6], [-20.5678, 147.2340, 0.8], [-19.8912, 146.5673, 0.3], [-18.2346, 145.8906, 0.7],
    [-17.5679, 144.2339, 0.5], [-16.8913, 143.5672, 0.9], [-15.2347, 142.8905, 0.6], [-14.5680, 141.2338, 0.4], [-13.8914, 140.5671, 0.8],
    [-12.2348, 139.8904, 0.7], [-11.5681, 138.2337, 0.5], [-10.8915, 138.5670, 0.3], [-27.8234, 153.4567, 0.9], [-26.1567, 152.7890, 0.6],
    [-25.4890, 152.1223, 0.8], [-24.8223, 151.4556, 0.4], [-23.1556, 150.7889, 0.7], [-22.4889, 150.1222, 0.5], [-21.8222, 149.4555, 0.9],
    [-20.1555, 148.7888, 0.3], [-19.4888, 148.1221, 0.6], [-18.8221, 147.4554, 0.8], [-17.1554, 146.7887, 0.7], [-16.4887, 146.1220, 0.4],
    [-15.8220, 145.4553, 0.5], [-14.1553, 144.7886, 0.9], [-13.4886, 144.1219, 0.6], [-12.8219, 143.4552, 0.8], [-11.1552, 142.7885, 0.3],
    [-10.4885, 142.1218, 0.7], [-27.9876, 153.6789, 0.5], [-26.3210, 152.0122, 0.9], [-25.6543, 151.3455, 0.4], [-24.9876, 150.6788, 0.6],
    [-23.3209, 150.0121, 0.8], [-22.6542, 149.3454, 0.7], [-21.9875, 148.6787, 0.5], [-20.3208, 148.0120, 0.3], [-19.6541, 147.3453, 0.9],
    [-18.9874, 146.6786, 0.6], [-17.3207, 146.0119, 0.4], [-16.6540, 145.3452, 0.8], [-15.9873, 144.6785, 0.7], [-14.3206, 144.0118, 0.5],
    [-13.6539, 143.3451, 0.9], [-12.9872, 142.6784, 0.3], [-11.3205, 142.0117, 0.6], [-10.6538, 141.3450, 0.8], [-27.5678, 153.8901, 0.4],
    [-26.8901, 153.2234, 0.7], [-25.2234, 152.5567, 0.5], [-24.5567, 151.8900, 0.9], [-23.8900, 151.2233, 0.6], [-22.2233, 150.5566, 0.8],
    [-21.5566, 149.8899, 0.3], [-20.8899, 149.2232, 0.4], [-19.2232, 148.5565, 0.7], [-18.5565, 147.8898, 0.5], [-17.8898, 147.2231, 0.9],
    [-16.2231, 146.5564, 0.6], [-15.5564, 145.8897, 0.8], [-14.8897, 145.2230, 0.4], [-13.2230, 144.5563, 0.7], [-12.5563, 143.8896, 0.5],
    [-11.8896, 143.2229, 0.3], [-10.2229, 142.5562, 0.9], [-27.7890, 153.1123, 0.6], [-26.1223, 152.4456, 0.8], [-25.4556, 151.7789, 0.4],
    [-24.7889, 151.1122, 0.7], [-23.1222, 150.4455, 0.5], [-22.4555, 149.7788, 0.9], [-21.7888, 149.1121, 0.3], [-20.1121, 148.4454, 0.6],
    [-19.4454, 147.7787, 0.8], [-18.7787, 147.1120, 0.4], [-17.1120, 146.4453, 0.7], [-16.4453, 145.7786, 0.5], [-15.7786, 145.1119, 0.9],
    [-14.1119, 144.4452, 0.6], [-13.4452, 143.7785, 0.8], [-12.7785, 143.1118, 0.3], [-11.1118, 142.4451, 0.4], [-10.4451, 141.7784, 0.7],
    [-27.3456, 152.6789, 0.5], [-26.6789, 152.0122, 0.9], [-25.0122, 151.3455, 0.6], [-24.3455, 150.6788, 0.8], [-23.6788, 150.0121, 0.4],
    [-22.0121, 149.3454, 0.7], [-21.3454, 148.6787, 0.5], [-20.6787, 148.0120, 0.9], [-19.0120, 147.3453, 0.3], [-18.3453, 146.6786, 0.6],
    [-17.6786, 146.0119, 0.8], [-16.0119, 145.3452, 0.4], [-15.3452, 144.6785, 0.7], [-14.6785, 144.0118, 0.5], [-13.0118, 143.3451, 0.9],
    [-12.3451, 142.6784, 0.6], [-11.6784, 142.0117, 0.8], [-10.0117, 141.3450, 0.3], [-27.8901, 152.4567, 0.4], [-26.2234, 151.7890, 0.7],
    [-25.5567, 151.1223, 0.5], [-24.8900, 150.4556, 0.9], [-23.2233, 149.7889, 0.6], [-22.5566, 149.1222, 0.8], [-21.8899, 148.4555, 0.4],
    [-20.2232, 147.7888, 0.7], [-19.5565, 147.1221, 0.5], [-18.8898, 146.4554, 0.9], [-17.2231, 145.7887, 0.3], [-16.5564, 145.1220, 0.6],
    [-15.8897, 144.4553, 0.8], [-14.2230, 143.7886, 0.4], [-13.5563, 143.1219, 0.7], [-12.8896, 142.4552, 0.5], [-11.2229, 141.7885, 0.9],
    [-10.5562, 141.1218, 0.6], [-27.4567, 153.7890, 0.8], [-26.7890, 153.1223, 0.3], [-25.1223, 152.4556, 0.4], [-24.4556, 151.7889, 0.7],
    [-23.7889, 151.1222, 0.5], [-22.1222, 150.4555, 0.9], [-21.4555, 149.7888, 0.6], [-20.7888, 149.1221, 0.8], [-19.1221, 148.4554, 0.4],
    [-18.4554, 147.7887, 0.7], [-17.7887, 147.1220, 0.5], [-16.1220, 146.4553, 0.9], [-15.4553, 145.7886, 0.3], [-14.7886, 145.1219, 0.6],
    [-13.1219, 144.4552, 0.8], [-12.4552, 143.7885, 0.4], [-11.7885, 143.1218, 0.7], [-10.1218, 142.4551, 0.5], [-27.6789, 152.8901, 0.9],
    [-26.0122, 152.2234, 0.6], [-25.3455, 151.5567, 0.8], [-24.6788, 150.8900, 0.4], [-23.0121, 150.2233, 0.7], [-22.3454, 149.5566, 0.5],
    [-21.6787, 148.8899, 0.9], [-20.0120, 148.2232, 0.3], [-19.3453, 147.5565, 0.6], [-18.6786, 146.8898, 0.8], [-17.0119, 146.2231, 0.4],
    [-16.3452, 145.5564, 0.7], [-15.6785, 144.8897, 0.5], [-14.0118, 144.2230, 0.9], [-13.3451, 143.5563, 0.6], [-12.6784, 142.8896, 0.8],
    [-11.0117, 142.2229, 0.3], [-10.3450, 141.5562, 0.4], [-27.2345, 152.1234, 0.7], [-26.5678, 151.4567, 0.5], [-24.8901, 150.7890, 0.9],
    [-24.2234, 150.1223, 0.6], [-23.5567, 149.4556, 0.8], [-21.8890, 148.7889, 0.4], [-21.2223, 148.1222, 0.7], [-20.5556, 147.4555, 0.5],
    [-18.8889, 146.7888, 0.9], [-18.2222, 146.1221, 0.3], [-17.5555, 145.4554, 0.6], [-15.8888, 144.7887, 0.8], [-15.2221, 144.1220, 0.4],
    [-14.5554, 143.4553, 0.7], [-12.8887, 142.7886, 0.5], [-12.2220, 142.1219, 0.9], [-11.5553, 141.4552, 0.6], [-9.8886, 140.7885, 0.8],
    [-27.8567, 153.3456, 0.3], [-26.1890, 152.6789, 0.4], [-25.5223, 152.0122, 0.7], [-23.8556, 151.3455, 0.5], [-23.1889, 150.6788, 0.9],
    [-22.5222, 150.0121, 0.6], [-20.8555, 149.3454, 0.8], [-20.1888, 148.6787, 0.4], [-19.5221, 148.0120, 0.7], [-17.8554, 147.3453, 0.5],
    [-17.1887, 146.6786, 0.9], [-16.5220, 146.0119, 0.3], [-14.8553, 145.3452, 0.6], [-14.1886, 144.6785, 0.8], [-13.5219, 144.0118, 0.4],
    [-11.8552, 143.3451, 0.7], [-11.1885, 142.6784, 0.5], [-10.5218, 142.0117, 0.9], [-27.9678, 153.5678, 0.6], [-26.3001, 152.8901, 0.8],
    [-25.6334, 152.2234, 0.4], [-23.9667, 151.5567, 0.7], [-23.3000, 150.8900, 0.5], [-22.6333, 150.2233, 0.9], [-20.9666, 149.5566, 0.3],
    [-20.2999, 148.8899, 0.6], [-19.6332, 148.2232, 0.8], [-17.9665, 147.5565, 0.4], [-17.2998, 146.8898, 0.7], [-16.6331, 146.2231, 0.5],
    [-14.9664, 145.5564, 0.9], [-14.2997, 144.8897, 0.6], [-13.6330, 144.2230, 0.8], [-11.9663, 143.5563, 0.3], [-11.2996, 142.8896, 0.4],
    [-10.6329, 142.2229, 0.7], [-27.1456, 152.3678, 0.5], [-26.4789, 151.7001, 0.9], [-24.8122, 151.0334, 0.6], [-24.1455, 150.3667, 0.8],
    [-23.4788, 149.7000, 0.4], [-21.8121, 149.0333, 0.7], [-21.1454, 148.3666, 0.5], [-20.4787, 147.6999, 0.9], [-18.8120, 147.0332, 0.3],
    [-18.1453, 146.3665, 0.6], [-17.4786, 145.6998, 0.8], [-15.8119, 145.0331, 0.4], [-15.1452, 144.3664, 0.7], [-14.4785, 143.6997, 0.5],
    [-12.8118, 143.0330, 0.9], [-12.1451, 142.3663, 0.6], [-11.4784, 141.6996, 0.8], [-27.5789, 152.9012, 0.3], [-26.9122, 152.2345, 0.4],
    [-25.2455, 151.5678, 0.7], [-24.5788, 150.9011, 0.5], [-23.9121, 150.2344, 0.9], [-22.2454, 149.5677, 0.6], [-21.5787, 148.9010, 0.8],
    [-20.9120, 148.2343, 0.4], [-19.2453, 147.5676, 0.7], [-18.5786, 146.9009, 0.5], [-17.9119, 146.2342, 0.9], [-16.2452, 145.5675, 0.3],
    [-15.5785, 144.9008, 0.6], [-14.9118, 144.2341, 0.8], [-13.2451, 143.5674, 0.4], [-12.5784, 142.9007, 0.7], [-11.9117, 142.2340, 0.5]
  ];

  return (
    <div style={{ height: '100vh', width: '100%', position: 'relative' }}>
      <div style={{ 
        position: 'absolute', 
        top: '20px', 
        left: '50%', 
        transform: 'translateX(-50%)', 
        zIndex: 1000, 
        backgroundColor: 'rgba(255, 255, 255, 0.9)', 
        padding: '10px 20px', 
        borderRadius: '8px', 
        boxShadow: '0 2px 10px rgba(0, 0, 0, 0.1)',
        fontSize: '24px',
        fontWeight: 'bold',
        color: '#333'
      }}>
        Data Centre Compass
      </div>
      <div style={{ 
        position: 'absolute', 
        bottom: '20px', 
        right: '20px', 
        zIndex: 1000, 
        backgroundColor: 'rgba(255, 255, 255, 0.9)', 
        padding: '8px 12px', 
        borderRadius: '6px', 
        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
        fontSize: '12px',
        color: '#666'
      }}>
        Designed by Dual Core team for Govhack 2025
      </div>
      <MapContainer 
        center={position} 
        zoom={6} 
        style={{ height: '100%', width: '100%' }}
      >
        <LayersControl position="topright">
          <LayersControl.BaseLayer checked name="OpenStreetMap">
            <TileLayer
              attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
              url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            />
          </LayersControl.BaseLayer>
          
          <LayersControl.BaseLayer name="Satellite">
            <TileLayer
              attribution='&copy; <a href="https://www.esri.com/">Esri</a>'
              url="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"
            />
          </LayersControl.BaseLayer>
          
          <LayersControl.BaseLayer name="Terrain">
            <TileLayer
              attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
              url="https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png"
            />
          </LayersControl.BaseLayer>

          <LayersControl.Overlay checked name="Markers">
            <>
              {markers.map((marker, index) => (
                <Marker key={index} position={marker.position}>
                  <Popup>{marker.popup}</Popup>
                </Marker>
              ))}
            </>
          </LayersControl.Overlay>

          <LayersControl.Overlay name="Circle Area">
            <Circle
              center={[-27.4705, 153.0260]}
              pathOptions={{ fillColor: 'blue', color: 'blue' }}
              radius={20000}
            >
              <Popup>Circle overlay showing 20km radius</Popup>
            </Circle>
          </LayersControl.Overlay>

          <LayersControl.Overlay name="GeoJSON Area">
            <GeoJSON
              data={sampleGeoJSON}
              style={() => ({
                color: '#ff7800',
                weight: 2,
                fillColor: '#ff7800',
                fillOpacity: 0.2
              })}
            >
              <Popup>Sample GeoJSON polygon</Popup>
            </GeoJSON>
          </LayersControl.Overlay>

          <LayersControl.Overlay name="Data Intensity Heatmap">
            <HeatmapLayer data={heatmapData} />
          </LayersControl.Overlay>
        </LayersControl>
      </MapContainer>
    </div>
  );
};

export default App;